more nested loops and functions, how fun :( 
